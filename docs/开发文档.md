本文档描述了项目的开发目的等内容。

实现一个RTSP回放录制服务端，使用Minimal API+react+typescript实现一个前端页面。用户双击可执行程序后，提示用户访问前端页面。

可以禁用国际化，以NativeAOT友好为目标。

技术栈：
- 后端：.NET 10 Minimal API
- 前端：react + typescript。
- 实时通信：WebSocket
- 编译目标： 必须支持 NativeAOT (Ahead-of-Time) 编译。这意味着：
    - 禁止使用 `Newtonsoft.Json`，必须使用 `System.Text.Json` 并配合 Source Generator。
    - 避免使用严重依赖运行时反射的第三方库。


## 关于RTSP录制的实现
请完全参考以下源码：/Users/macmini/code/GitHub/RtspRecorder
- 你需要分析参考代码，提取核心的RTSP连接、流捕获、写入文件逻辑。
- 将其封装为一个 `IRecordingService`，支持异步启动和停止。

## 配置文件
请使用 `System.Text.Json` 源生成器读取以下配置。
### APP配置文件和频道配置
APP配置文件：程序运行路径下的recsettings.json文件。
```json
{
    "port": 8080,
    "recordPath": "./records",
    "host": ["0.0.0.0"],
    "useAuth": false, // 如果为true，进入WebUI需简单的Basic Auth验证
    "username": "admin",
    "password": "admin",
    "maxRecordingTasks": 1 // 最大同时录制任务数
}
```
频道配置文件：程序运行路径下的channels.json文件。支持CRUD操作，ID自增或唯一即可。
```json
[
  {
    "id": 0,
    "name": "CCTV-1综合高清",
    "url": "rtsp://183.59.144.166/PLTV/88888888/224/3221229774/10000100000000060000000008842383_0.smil"
  },
  {
    "id": 1,
    "name": "CCTV-2财经高清",
    "url": "rtsp://183.59.144.166/PLTV/88888888/224/3221229763/10000100000000060000000008839684_0.smil"
  },
  {
    "id": 2,
    "name": "CCTV-7军事农业高清",
    "url": "rtsp://183.59.144.166/PLTV/88888888/224/3221229730/10000100000000060000000008839665_0.smil"
  }
]
```

## WEBUI
- 风格： 参考 Tvheadend，紧凑型布局，数据密度高。
- 主题： 支持浅色/深色模式切换 (Dark/Light Mode)，默认跟随系统。
- 布局： 响应式设计，必须兼容移动端。

### 主页面
页面顶部展示：当前用户、磁盘剩余空间（需计算 recordPath 所在磁盘）、系统时间。

#### 主页面（任务管理页面）
表格列：频道ID、频道名称、起始时间、结束时间、录制进度条、已录制大小(KB/MB/GB自动计算)、录制状态（正在录制/等待录制/已完成/失败等，需要用不同颜色表示）、操作按钮（开始录制/停止录制）。
录制结束后，操作区域按钮变为“查看”、“下载”、“删除”，点击“查看”时调用mediainfo命令查看文件信息，点击“下载”时直接流式传输文件给浏览器。点击“删除”时，会弹出确认框，确认后发送删除请求给服务端，只删除任务，不删除文件。

- 列： 频道ID | 频道名称 | 计划开始时间 | 计划结束时间 | 进度条 | 已录大小(动态更新) | 状态 | 操作
- 状态枚举： Pending(等待中), Recording(录制中), Completed(已完成), Failed(失败), Stopped(手动停止)。
- 进度条： 根据 (当前时间 - 开始时间) / 总时长 计算。
- 操作按钮：
    - 录制中：[停止录制]
    - 已结束：[查看Info] [下载] [删除]
- 交互逻辑：
    -查看Info： 后端调用 mediainfo 命令行（假设环境已安装）或使用 FFmpeg 库获取视频元数据，弹窗显示。
    -下载： 浏览器直接流式下载生成的文件。
    -删除： 二次确认后，仅删除数据库中的任务记录，不物理删除文件。

#### 新建录制任务 (Modal弹窗)
- 字段：
    - 选择频道 (下拉框)
    - 开始时间 & 结束时间 (精确到秒，格式 `yyyy-MM-dd HH:mm:ss`)
    - 任务名称 (可选。默认格式：`Playback_{ChannelName}_{StartTime}_{EndTime}`。如果用户填了，则替换 `Playback`)
- 记忆功能： 使用 localStorage 记住用户上次填写的时长或偏好。
- 冲突检测： 提交时检查是否超过 `maxRecordingTasks`， 允许排队，状态为Pending。

### 应用配置页面
仅开放配置`maxRecordingTasks`，别的都隐藏。

### 频道配置页面
可以编辑频道列表，包括添加、删除、修改频道。无需分页，全部以表格形式展示。修改结果同步到对应的json文件。

### 录制管理页面
可以查看已经录制过的所有文件，包括文件名、文件大小、录制时间等。提供一个按钮能直接查看文件的mediainfo（调用命令行）。

## 实现细节
1. 后台调度器： 实现一个 `BackgroundService`，每秒轮询一次。检查是否有 Pending 任务到达开始时间。如果当前并发数 < `maxRecordingTasks`，则开始录制。
2. 日志： 同时要求console/file输出，输出录制开始、停止、错误信息。每天一个日志文件自动处理。保存文件夹为程序运行路径下的logs文件夹。
3. 获取运行文件夹：同时考虑dotnet dll启动和直接运行可执行文件的情况。
4. 未来的时间：如果用户输入了一个未来的时间，而当前时间还未到该时间，那么就等待到该时间再开始录制。同时为了避免回放内容还没有生成，此类情况需要等待一会儿再开始录制。
